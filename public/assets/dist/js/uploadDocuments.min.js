let file=null,pi=0,fileDragHover=e=>{let t=document.getElementById("file-drag");e.stopPropagation(),e.preventDefault(),t.className="dragover"===e.type?"hover":"modal-body file-upload"},fileSelectHandler=e=>{let t=e.target.files||e.dataTransfer.files;fileDragHover(e);for(let e,a=0;e=t[a];a++)parseFile(e,++pi)},output=e=>$("#messages").html(e),parseFile=(e,t)=>{let a=(file=e).name;/\.(?=pdf|png|jpeg|jpg)/gi.test(a)?($("#response").append(`<div id="title${t}">${encodeURI(file.name)}</div><progress class="progress" id="file-progress${t}" value="0"></progress>`),$("#start").hide(),$("#notgoodfile").hide(),$("#response").show(),$("#documents-preview").show(),$("#file-progress").attr("max",file.size),uploadFile(file,t)):(output("<strong>Mauvais format. Formats autorisé : pdf, png ou pnj</strong>"),$("#start").show(),$("#notgoodfile").show(),$("#response").hide(),$("#documents-preview").hide(),document.getElementById("file-upload-form").reset())},updateFileProgress=e=>{e.lengthComputable&&e.lengthComputable&&$(`#file-progress${e.target.i}`).attr("value",e.loaded)};function uploadFile(e,t){file=e;let a=new XMLHttpRequest,i=document.getElementById(`file-progress${t}`),o=$("#file-upload").attr("name");if(a.upload)if(file.size<=107374182400){i.style.display="inline",a.upload.addEventListener("progress",updateFileProgress,!1),a.upload.i=t,a.onreadystatechange=function(e){if($(`#file-progress${t}`).attr("class",`progress ${200===a.status?"success":"failure"}`),$("#start").show(),4===a.readyState&&200===a.status){let e=JSON.parse(a.response);if(e.id){let a=`/static/uploads/candidates/documents/${e.filename}`,i=` - <button class="btn btn-simple btn-danger btn-icon remove" data-type="document" data-id="${e.id}"><i class="fa fa-trash"></i></button>`;notification({icon:"check-circle",type:"success",title:"Document sauvegardé :",message:"Votre document a correctement été sauvegarder sur nos serveurs."}),$(`#${o}List ul`).append(`<li><a href="${a}" target="_blank">${e.name}</a>${i}</li>`),$(`#${o}Count`).html(parseInt($(`#${o}Count`).html())+1),$(`i[data-type="${o}"]`).attr("class","fal fa-check-circle fa-2x"),setTimeout(()=>{$(`#file-progress${t}`).fadeOut().remove(),$(`#title${t}`).fadeOut().remove()},5e3)}}else 4===a.readyState&&400===a.status&&"Document of same type with same name already exist."===a.response&&($(`#file-progress${t}`).remove(),$(`#title${t}`).fadeOut().remove(),notification({icon:"exclamation",type:"danger",title:"Doublon détécté :",message:"Un document de même type portant le même nom existe déjà sur votre compte."}))},a.open("POST",document.getElementById("file-upload-form").action,!0),a.setRequestHeader("x-csrf-token",$("#csrfToken").val()),a.setRequestHeader("X-File-Name",file.name),a.setRequestHeader("X-File-Size",file.size);let e=new FormData;e.append(o,file),a.send(e)}else output("Please upload a smaller file (< 10240 MB).")}if(window.File&&window.FileList&&window.FileReader){let e=document.getElementById("file-upload"),t=(document.getElementById("video-preview"),document.getElementById("file-drag"));e.addEventListener("change",fileSelectHandler,!1),(new XMLHttpRequest).upload&&(t.addEventListener("dragover",fileDragHover,!1),t.addEventListener("dragleave",fileDragHover,!1),t.addEventListener("drop",fileSelectHandler,!1))}else document.getElementById("file-drag").style.display="none";$("#removeVideo").click(()=>{$.post("/api/candidate/delete/video",{_csrf:_csrf},e=>{document.getElementById("video-preview").pause(),$("#video-preview").removeAttr("src"),"done"===e.result&&(output(""),$("#start").show(),$("i.fa-video-camera").show(),$("#response").hide(),$("#removeVideo").hide(),$("#video-preview").hide(),notification({icon:"check-circle",type:"success",title:"Vidéo de profil supprimée :",message:"Votre vidéo de présentation a correctement été supprimée de votre profil."}))})}),$('i[data-action="addDoc"]').click(function(){let e=$(this).attr("data-type"),t=$("#file-upload"),a=$("#file-upload-btn");switch($("#response").empty().hide(),t.attr({name:e}),e){case"DIP":a.html("Selectionnez un ou plusieurs diplômes");break;case"CNI":a.html("Selectionnez votre pièce d'identité");break;case"VIT":a.html("Selectionnez votre carte vitale ou attestation de santé");break;case"RIB":a.html("Selectionnez votre RIB");break;case"OrNa":a.html("Selectionnez votre Attestation d'inscription à l'Ordre National");break;case"CV":a.html("Selectionnez votre CV");break;case"LM":a.html("Selectionnez votre lettre de motivation");break;case"ADELI":a.html("Selectionnez votre justificatif de référencement ADELI")}$("form").show()});