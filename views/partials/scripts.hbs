<script src="/static/assets/js/perfect-scrollbar.min.js" type="text/javascript"></script>
<script src="/static/assets/js/star-rating.min.js" type="text/javascript"></script>
<script src="/static/assets/js/dashboard.js"></script>
<script src="/static/javascripts/main.js"></script>
<script src="/static/assets/js/timepicker.js"></script>
<script src="/static/assets/js/jquery.ultima.block.min.js"></script>
<script>
    // $(document).ready(() => {
        // $("[data-toggle=popover]").popover();
        {{#if sequelizeError}}
            {{#each sequelizeError.errors as |error|}}
                $('#{{error.path}}').css('border', '3px solid red');
            {{/each}}
        {{/if}}

    // });

        {{#if error_msg}}
            notification({
                icon: 'exclamation',
                type: 'danger',
                title: '{{tr.partials.scripts.notify_error_title}} :',
                message: `{{error_msg}}`
            });
        {{/if}}
        {{#if success_msg}}
        notification({
            icon: 'check-circle',
            type: 'success',
            title: '{{tr.partials.scripts.notify_success_title}} :',
            message: `{{success_msg}}`
        });
        {{/if}}

        {{#if session.originalUser}}
            let roState = '{{ readOnly }}';
            if ('lock' === roState) {
                $('#bodyContent').block('Compte en lecture seule.');
            }
            $('#removeReadOnly').click(() => {
              if ('lock' === roState) $("#removeReadOnlyModal").modal();
              else {
                  $.get('/back-office/impersonatePutReadOnly', (data) => {
                      if (data.status === 'ok') {
                          roState = 'lock';
                          $('#removeReadOnly').attr('class', 'fa fa-lock');
                          $('#bodyContent').block('Compte en lecture seule.');
                          notification({
                              icon: 'check-circle',
                              type: 'success',
                              title: 'Activation de la lecture seule validée :',
                              message: `Vous ne pouvez plus intéragir sur ce compte.`
                          });
                      } else {
                      }
                  });
              }
            });
            let removeRO = () => {
                let password = $('#removeROPassword').val();
                let _csrf = $('#csrfToken').val();
                $.post('/back-office/impersonateRemoveReadOnly', { password, _csrf }, (data) => {
                  if (data.status === 'send') {
                      $("#removeReadOnlyModal").modal('hide');
                      let pinCode = prompt('Code PIN envoyé sur discord. Veuillez le saisir ici :');
                      $.post('/back-office/impersonateRemoveReadOnly/validate', { pinCode, _csrf }, (response) => {
                        if (response.authorized) {
                          roState = 'unlock';
                          $('#removeReadOnly').attr('class', 'fa fa-unlock');
                          $('#bodyContent').unblock();
                            notification({
                                icon: 'check-circle',
                                type: 'success',
                                title: 'Désactivation de la lecture seule validée :',
                                message: `Vous pouvez maintenant intéragir sur ce compte.`
                            });
                        }
                      });
                  } else {

                  }
                });
            };
        {{/if}}
</script>
