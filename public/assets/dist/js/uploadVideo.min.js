let file=null,fileDragHover=e=>{let t=document.getElementById("file-drag");e.stopPropagation(),e.preventDefault(),t.className="dragover"===e.type?"hover":"modal-body file-upload"},fileSelectHandler=e=>{let t=e.target.files||e.dataTransfer.files;fileDragHover(e),t.length>1?output("<strong>Vous ne pouvez uploader qu'une vidéo.</strong>"):parseFile(t[0])},output=e=>$("#messages").html(e),parseFile=e=>{file=e,output("<strong>"+encodeURI(file.name)+"</strong>");let t=file.name,o=$("#videoSrc");/\.(?=mp4)/gi.test(t)?($("#start").hide(),$("#notvideo").hide(),$("#response").show(),$("#video-preview").show(),o[0].src=URL.createObjectURL(file),o.parent()[0].load(),o.attr("data-type","preview"),$("#file-progress").attr("max",file.size)):(output("<strong>Mauvais format. Formats autorisé : mp4</strong>"),$("#start").show(),$("#notvideo").show(),$("#response").hide(),$("#video-preview").hide(),document.getElementById("file-upload-form").reset())},updateFileProgress=e=>{e.lengthComputable&&e.lengthComputable&&$("#file-progress").attr("value",e.loaded)};function uploadFile(e){file=e;let t=new XMLHttpRequest,o=(document.getElementById("class-roster-file"),document.getElementById("file-progress"));if(t.upload)if(file.size<=107374182400){o.style.display="inline",t.upload.addEventListener("progress",updateFileProgress,!1),t.onreadystatechange=function(e){$("#file-progress").attr("class",`progress ${200===t.status?"success":"failure"}`),4===t.readyState&&200===t.status&&($("#removeVideo").show(),notification({icon:"check-circle",type:"success",title:"Vidéo de profil sauvegardée :",message:"Votre vidéo de présentation a correctement été ajoutée à votre profil."}))},t.open("POST",document.getElementById("file-upload-form").action,!0),t.setRequestHeader("x-csrf-token",$("#csrfToken").val()),t.setRequestHeader("X-File-Name",file.name),t.setRequestHeader("X-File-Size",file.size);let e=new FormData;e.append("file",file),t.send(e)}else output("Please upload a smaller file (< 10240 MB).")}if(window.File&&window.FileList&&window.FileReader){let e=document.getElementById("file-upload"),t=document.getElementById("video-preview"),o=document.getElementById("file-drag");e.addEventListener("change",fileSelectHandler,!1),t.addEventListener("loadedmetadata",()=>{if("preview"!==$("#videoSrc").attr("data-type"))return!1;$("#videoSrc").parent()[0].duration.toFixed(2)<=600?uploadFile(file):(output("<strong>Vidéo trop longue. Durée maximale autorisée : 10 minutes.</strong>"),$("#start").show(),$("#response").hide(),$("#video-preview").hide(),document.getElementById("file-upload-form").reset(),notification({icon:"exclamation",type:"danger",title:"Impossible d'enregistrer cette vidéo :",message:"La durée de votre vidéo est plus grand que la limite autorisée : 10 minutes."}))}),(new XMLHttpRequest).upload&&(o.addEventListener("dragover",fileDragHover,!1),o.addEventListener("dragleave",fileDragHover,!1),o.addEventListener("drop",fileSelectHandler,!1))}else document.getElementById("file-drag").style.display="none";$("#removeVideo").click(()=>{$.post("/api/candidate/delete/video",{_csrf:_csrf},e=>{document.getElementById("video-preview").pause(),$("#video-preview").removeAttr("src"),"done"===e.result&&(output(""),$("#start").show(),$("i.fa-video-camera").show(),$("#response").hide(),$("#removeVideo").hide(),$("#video-preview").hide(),notification({icon:"check-circle",type:"success",title:"Vidéo de profil supprimée :",message:"Votre vidéo de présentation a correctement été supprimée de votre profil."}))})});