$(".add").click(function(){let e=!1,t={},a=$(this).attr("data-type"),i=$(`#${a}`).serializeArray();$.each(i,(e,a)=>t[a.name]=a.value),"experience"===a&&(t.current="on"===t.current,t.internship="on"===t.internship),t.start=new Date(t.start.split("/")[1],t.start.split("/")[0]-1),t.end=new Date(t.end.split("/")[1],t.end.split("/")[0]-1),t._csrf=$("#csrfToken").val(),isNaN(t.start.getTime())&&(notification({icon:"exclamation",type:"danger",title:"Champ invalide :",message:"Vous devez indiquer une date de début valide."}),e=!0),"experience"===a?(""===t.name&&(notification({icon:"exclamation",type:"danger",title:"Champ invalide :",message:"Vous devez indiquer une nom pour votre expérience."}),e=!0),!t.current&&isNaN(t.end.getTime())&&(notification({icon:"exclamation",type:"danger",title:"Champ invalide :",message:"Vous devez indiquer une date de fin valide."}),e=!0)):isNaN(t.end.getTime())&&(notification({icon:"exclamation",type:"danger",title:"Champ invalide :",message:"Vous devez indiquer une date de fin valide."}),e=!0),e||(isNaN(t.end.getTime())&&(t.end=null),$.post(`/add/${a}`,t,e=>{if($(`form#${a}`).trigger("reset"),"experience"===a){if(e.experience){notification({icon:"check-circle",type:"success",title:"Expérience ajoutée avec succès :",message:`Votre expérience nommée "${e.experience.name}" vient d'être ajoutée à votre profil.`});let t=moment(new Date(e.experience.start)).format("MM/YYYY"),a=e.experience.current?"maintenant":moment(new Date(e.experience.end)).format("MM/YYYY"),i=e.experience.internship?"<small>(stage)</small>":"";$(".noXPAvailable").is(":visible")&&$(".noXPAvailable").remove(),$("#experienceTbody").append($("<tr>").attr("data-xpId",e.experience.id).append($("<td>").html(`${t} - ${a} ${i}`)).append($("<td>").text(`${e.experience.name}`)).append($("<td>").text(`${e.experience.poste.name}`)).append($("<td>").append($("<label>").attr("class","label label-warning").text(`${e.experience.service.name}`))).append($("<td>").append($("<button>").attr({class:"btn btn-simple btn-warning btn-icon editXP","data-id":e.experience.id}).html('<i class="ti-pencil-alt"></i>')).append($("<button>").attr({class:"btn btn-simple btn-danger btn-icon removeXP","data-id":e.experience.id}).html('<i class="ti-close"></i>'))))}}else if("formation"===a){if(e.formation){notification({icon:"check-circle",type:"success",title:"Formation ajoutée avec succès :",message:`Votre formation nommée "${e.formation.name}" vient d'être ajoutée à votre profil.`});let t=moment(new Date(e.formation.start)).format("MM/YYYY"),a=e.formation.end?moment(new Date(e.formation.end)).format("MM/YYYY"):"maintenant";$(".noFormationAvailable").is(":visible")&&$(".noFormationAvailable").remove(),$("#formationsTbody").append($("<tr>").attr("data-formationId",e.formation.id).append($("<td>").html(`${t} - ${a}`)).append($("<td>").text(`${e.formation.name}`)).append($("<td>").append($("<button>").attr({class:"btn btn-simple btn-warning btn-icon editFormation","data-id":e.formation.id}).html('<i class="ti-pencil-alt"></i>')).append($("<button>").attr({class:"btn btn-simple btn-danger btn-icon removeFormation","data-id":e.formation.id}).html('<i class="ti-close"></i>'))))}}else if("diploma"===a&&e.diploma){notification({icon:"check-circle",type:"success",title:"Diplôme ajoutée avec succès :",message:`Votre diplôme nommée "${e.diploma.name}" vient d'être ajouté à votre profil.`});let t=moment(new Date(e.diploma.start)).format("MM/YYYY"),a=e.diploma.end?moment(new Date(e.diploma.end)).format("MM/YYYY"):"maintenant";$(".noDiplomaAvailable").is(":visible")&&$(".noDiplomaAvailable").remove(),$("#diplomaTbody").append($("<tr>").attr("data-diplomaId",e.diploma.id).append($("<td>").html(`${t} - ${a}`)).append($("<td>").text(`${e.diploma.name}`)).append($("<td>").append($("<button>").attr({class:"btn btn-simple btn-warning btn-icon editDiploma","data-id":e.diploma.id}).html('<i class="ti-pencil-alt"></i>')).append($("<button>").attr({class:"btn btn-simple btn-danger btn-icon removeDiploma","data-id":e.diploma.id}).html('<i class="ti-close"></i>'))))}}).catch(e=>errorsHandler(e)))}),$("#service_id").select2(),$("#post_id").select2(),$("body").on("click","button.removeXP",e=>{let t=$(e.target).attr("data-id")||$(e.target).parent().attr("data-id");$("#btnRemoveXp").attr("onclick",`removeCandidateExperience(${t})`),$("#removeExperienceModal").modal()}).on("click","button.removeFormation",e=>{let t=$(e.target).attr("data-id")||$(e.target).parent().attr("data-id");$("#btnRemoveFormation").attr("onclick",`removeCandidateFormation(${t})`),$("#removeFormationModal").modal()}).on("click","button.removeDiploma",e=>{let t=$(e.target).attr("data-id")||$(e.target).parent().attr("data-id");$("#btnRemoveDiploma").attr("onclick",`removeCandidateDiploma(${t})`),$("#removeDiplomaModal").modal()}).on("click","button.editXP",e=>{let t=$(e.target).attr("data-id")||$(e.target).parent().attr("data-id");$.get(`/api/candidate/xp/${t}`,e=>{if(e.experience){let a=new Date(e.experience.start),i=null===e.experience.end?null:new Date(e.experience.end);$("#editName").val(e.experience.name),$("#editPost_id").val(e.experience.poste_id),$("#editService_id").val(e.experience.service_id),$("#editStart").val(`${("0"+(a.getMonth()+1)).slice(-2)}/${a.getFullYear()}`),$("#editInternship").prop("checked",!!e.experience.internship),$("#editCurrent").prop("checked",!!e.experience.current),null===i?$("#editEnd").prop("disabled",!0):($("#editEnd").prop("disabled",!1),$("#editEnd").val(`${("0"+(i.getMonth()+1)).slice(-2)}/${i.getFullYear()}`)),$("#editXpModal").modal(),$("#editXPId").val(t),$("#editXP").attr("onclick",`editXP(${$("#editXP").attr("data-id")})`)}}).catch(e=>{notification({icon:"exclamation",type:"danger",title:"Une erreur est survenue :",message:"Impossible de récupérer les informations de cette experience."})})}).on("click","button.editFormation",e=>{let t=$(e.target).attr("data-id")||$(e.target).parent().attr("data-id");$.get(`/api/candidate/formation/${t}`,e=>{e.formation&&createModal({id:"editFormationModal",modal:"editFormation",title:'<span class="ti-pencil-alt"></span> Modifier une formation'},()=>{let a=new Date(e.formation.start),i=null===e.formation.end?null:new Date(e.formation.end);$("#editFName").val(e.formation.name),$("#editFStart").val(`${("0"+(a.getMonth()+1)).slice(-2)}/${a.getFullYear()}`),null===i?$("#editFEnd").prop("disabled",!0):($("#editFEnd").prop("disabled",!1),$("#editFEnd").val(`${("0"+(i.getMonth()+1)).slice(-2)}/${i.getFullYear()}`)),$("#editFormationId").val(t),$("#editFormation").attr("onclick",`editFormation(${$("#editFormation").attr("data-id")})`)})}).catch(e=>{notification({icon:"exclamation",type:"danger",title:"Une erreur est survenue :",message:"Impossible de récupérer les informations de cette formation."})})}).on("click","button.editDiploma",e=>{let t=$(e.target).attr("data-id")||$(e.target).parent().attr("data-id");$.get(`/api/candidate/diploma/${t}`,e=>{e.diploma&&createModal({id:"editDiplomaModal",modal:"editDiploma",title:'<span class="ti-pencil-alt"></span> Modifier un diplôme'},()=>{let t=new Date(e.diploma.start),a=null===e.diploma.end?null:new Date(e.diploma.end);$("#editDName").val(e.diploma.name),$("#editDStart").val(`${("0"+(t.getMonth()+1)).slice(-2)}/${t.getFullYear()}`),null===a?$("#editDEnd").prop("disabled",!0):($("#editDEnd").prop("disabled",!1),$("#editDEnd").val(`${("0"+(a.getMonth()+1)).slice(-2)}/${a.getFullYear()}`))})}).catch(e=>{notification({icon:"exclamation",type:"danger",title:"Une erreur est survenue :",message:"Impossible de récupérer les informations de ce diplôme."})})});let removeCandidateExperience=e=>{let t=$("#csrfToken").val();$.delete(`/api/candidate/xp/${e}`,{_csrf:t},t=>{t.done&&($(`tr[data-xpId="${e}"]`).remove(),notification({icon:"check-circle",type:"success",title:"Expérience supprimée avec succès :",message:"Votre expérience vient d'être supprimée de votre profil."}))}).catch(e=>{notification({icon:"exclamation",type:"danger",title:"Une erreur est survenue :",message:"Impossible de supprimer cette experience."})})},removeCandidateFormation=e=>{let t=$("#csrfToken").val();$.delete(`/api/candidate/formation/${e}`,{_csrf:t},t=>{t.done&&($(`tr[data-formationId="${e}"]`).remove(),notification({icon:"check-circle",type:"success",title:"Formation supprimée avec succès :",message:"Votre formation vient d'être supprimée de votre profil."}))}).catch(e=>{notification({icon:"exclamation",type:"danger",title:"Une erreur est survenue :",message:"Impossible de supprimer cette formation."})})},removeCandidateDiploma=e=>{let t=$("#csrfToken").val();$.delete(`/api/candidate/diploma/${e}`,{_csrf:t},t=>{t.done&&($(`tr[data-diplomaId="${e}"]`).remove(),notification({icon:"check-circle",type:"success",title:"Diplôme supprimée avec succès :",message:"Votre diplôme vient d'être supprimé de votre profil."}))}).catch(e=>{notification({icon:"exclamation",type:"danger",title:"Une erreur est survenue :",message:"Impossible de supprimer ce diplôme."})})},editXP=e=>{let t=$("#csrfToken").val(),a=($("#editName").val(),$("#editPost_id").val(),$("#editStart").val().split("/")),i=$("#editEnd").val().split("/"),n=new Date(a[1],a[0]-1),o=new Date(i[1],i[0]-1);$.put(`/api/candidate/formation/${$("#editFormationId").val()}`,{name:$("#editFName").val(),start:n,end:o,_csrf:t},e=>{"updated"===e.result?notification({type:"success",icon:"check-circle",title:"Formation editée :",message:"Votre formation a correctement été modifiée."}):e.errors&&errorsHandler(e.errors)}).catch(e=>errorsHandler(e))},editFormation=e=>{let t=$("#csrfToken").val(),a=$("#editFStart").val().split("/"),i=$("#editFEnd").val().split("/"),n=new Date(a[1],a[0]-1),o=new Date(i[1],i[0]-1);$.put(`/api/candidate/formation/${$("#editFormationId").val()}`,{name:$("#editFName").val(),start:n,end:o,_csrf:t},e=>{"updated"===e.result?notification({type:"success",icon:"check-circle",title:"Formation editée :",message:"Votre formation a correctement été modifiée."}):e.errors&&errorsHandler(e.errors)}).catch(e=>errorsHandler(e))};