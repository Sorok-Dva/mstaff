let toAutocomplete=["skills","equipments","softwares"];toAutocomplete.forEach(e=>{let t,a,i,s=[],r=e.substring(0,e.length-1),l=r.charAt(0).toUpperCase()+r.slice(1);$.get(`/api/${e}/all`,t=>$.map(t[`${e}`],e=>s.push(e.name))),$(`#${e}`).autocomplete({source:s,minLength:3,select:(e,t)=>{autocompleteTrigger({type:r,add:`addNew${l}`,already:`${r}AlreadyInList`},t.item.label)},search:(e,t)=>{autocompleteTrigger({type:r,add:`addNew${l}`,already:`${r}AlreadyInList`},e.target.value)}}),$(`#addNew${l}`).click(()=>{let s=$(`#${e}`).val(),l=$("#csrfToken").val();$.post(`/api/candidate/${r}/add`,{name:s,_csrf:l},a=>{switch(e){case"skills":t=`Cette compétence "${a.name}" vient d'être ajoutée à votre liste.`,i="Compétence ajoutée avec succès :";break;case"equipments":t=`Ce matériel ou produit "${a.name}" vient d'être ajouté à votre liste.`,i="Matériel / produit ajouté avec succès :";break;case"softwares":t=`Ce logiciel "${a.name}" vient d'être ajouté à votre liste.`,i="Logiciel ajouté avec succès :"}a&&($(`#${e}`).val(""),notification({icon:"check-circle",type:"success",title:i,message:t}),$(`#${e}List`).append($("<tr>").attr({"data-type":r,"data-id":a.id}).append($("<td>").text(`${a.name}`)).append($("<td>").append($("<div>").attr({class:"rating-stars text-center"}).append($("<ul>").attr({class:"stars","data-type":r,"data-id":a.id}).append($("<li>").attr({class:"star",title:"Fair","data-value":1}).html('<i class="fa fa-star"></i>')).append($("<li>").attr({class:"star",title:"Good","data-value":2}).html('<i class="fa fa-star"></i>')).append($("<li>").attr({class:"star",title:"Excellent","data-value":3}).html('<i class="fa fa-star"></i>'))))).append($("<td>").append($("<button>").attr({class:"btn btn-simple btn-danger btn-icon remove","data-type":r,"data-id":a.id}).html('<i class="fa fa-trash"></i>')))))}).catch(t=>{console.log(t);let i=t.responseJSON;switch(e){case"skills":a="Cette compétence est déjà ajoutée à votre profil.";break;case"equipments":a="Ce matériel ou produit est déjà ajouté à votre profil.";break;case"softwares":a="Ce logiciel est déjà ajouté à votre profil."}if("Already exists"!==t.error)return errorsHandler(i||t);notification({icon:"exclamation",type:"danger",title:"Ajout impossible",message:a})})})}),$("body").on("click",".remove",e=>{let t=$(e.target).attr("data-id")||$(e.target).parent().attr("data-id"),a=$(e.target).attr("data-type")||$(e.target).parent().attr("data-type");createModal({id:"removeSkillModal",modal:"removeSkill",title:"Confirmation"},()=>{$("#btnRemoveSkill").attr("onclick",`removeSkill('${a}', ${t})`)})});let autocompleteTrigger=(e,t)=>{$(`tr[data-type="${e.type}"]>td:contains('${t}')`).length>0?($(`#${e.add}`).attr("disabled","disabled"),$(`#${e.already}`).show()):($(`#${e.add}`).removeAttr("disabled"),$(`#${e.already}`).hide())},removeSkill=(e,t)=>{let a=$("#csrfToken").val();$.delete(`/api/candidate/${e}/${t}`,{_csrf:a},a=>{a.deleted&&(notification({icon:"check-circle",type:"success",title:"Compétence supprimée avec succès.",message:""}),$(`tr[data-type="${e}"][data-id="${t}"]`).remove())}).catch(e=>{if(void 0===(e=e.responseJSON)||"Not exists"!==e.error)return errorsHandler(e);notification({icon:"exclamation",type:"danger",title:"Suppression impossible",message:"Cette compétence n'est pas liée à votre profil."})})};