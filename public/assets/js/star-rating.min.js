let _csrf = $('#csrfToken').val();

$('body').on('mouseover', '.stars li', function(){
  let onStar = parseInt($(this).data('value'), 10); // The star currently mouse on

  // Now highlight all the stars that's not after the current hovered star
  $(this).parent().children('li.star').each(function(e){
    if (e < onStar) {
      $(this).addClass('hover');
    }
    else {
      $(this).removeClass('hover');
    }
  });
}).on('mouseout','.stars li', function(){
  $(this).parent().children('li.star').each(function(e){
    $(this).removeClass('hover');
  });
}).on('click', '.stars li', function() {
  let onStar = parseInt($(this).data('value'), 10); // The star currently selected
  let stars = $(this).parent().children('li.star');

  for (i = 0; i < stars.length; i++) {
    $(stars[i]).removeClass('selected');
  }

  for (i = 0; i < onStar; i++) {
    $(stars[i]).addClass('selected');
  }

  let ratingValue = parseInt($(this).last().data('value'), 10);
  let type = $(this).parent().attr('data-type');
  let id = $(this).parent().attr('data-id');

  $.post(`/api/candidate/rate/${type}/${id}`, {rate: ratingValue, _csrf}, (data) => {
    if (data) {
      notification({
        icon: 'check-circle',
        type: 'success',
        title: 'Niveau de compétence mis à jour.',
        message: ``
      });
    }
  }).catch(error => {
    error = error.responseJSON;
    if (error.error === 'Not exists') {
      notification({
        icon: 'exclamation',
        type: 'danger',
        title: 'Édition impossible',
        message: `Cette compétence n'est pas liée à votre profil.`
      });
    } else return errorsHandler(error);
  });
});